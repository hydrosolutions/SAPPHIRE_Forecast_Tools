
# Bulk 1 (04.02.2026)
- [x] Only Keep Operational Forecast Days in the Hindcast files (~ 5x less storage)
  - [x] Adjust configs file to have: operational_forecast_day, operational_lead_time_months 
  - [x] Integrate those in the forecast (?) and in the hindcast script
- [x] Strict about the columns saved.
- [x] Copy current hindcasts to a different place in order to test the workflow.
  - [x] Have a small script transforming all hindcast to only include operational_forecast_day.
- [x] Change today to be used as a global variable for all code scripts. 
- [x] Write a Mock Forecast script - run forecasts for 2024, 2025.
- [x] Change Logging in the LT Forecast Package - less verbose - only relevant parts.
- [ ] Optional (Fail Tracker - why do forecasts fail?)
- [ ] run simple calibration to test everything works still.
- [x] Evaluate the mock forecasts.

# Bulk 2 (05.02.2026)
- [ ] Data Interface to DataBase - no CSV
- [ ] Forecast and Hindcast writting to DataBase
- [ ] Run Mock Forecasts
- [ ] Run Mock Calibration
- [ ] Bayesian Correction

# Bulk 3 
- [ ] Update Documentation
- [ ] Release Stable LT-Forecast Version.
- [ ] Testing
- [ ] Commiting

# Bayesian Ratio Correction for Seasonal Forecasts

## Goal
Enforce relative seasonal constraints (e.g., Sep < Aug) probabilistically, weighted by confidence in climatology. This is done per basin and month and lead time.

---

## Steps

### 1. Compute Historical Ratios
For each month pair, calculate:
$$R = Q_{curr} / Q_{prev}$$
Store: mean ($\mu_R$), std ($\sigma_R$), sample size ($n$)

### 2. Quantify Climatology Uncertainty
With limited data, inflate prior variance:
$$\sigma_{R,eff} = \sigma_R \times \sqrt{1 + 1/n}$$

Compute constraint confidence:
$$p_{constraint} = n / (n + 2)$$

### 3. Convert Forecast to Ratio Space
$$R_{fc} = Q_{curr}^{fc} / Q_{prev}$$
$$\sigma_{R,fc} = \sigma_{curr}^{fc} / Q_{prev}$$

### 4. Bayesian Update on Ratio
Posterior precision:
$$\tau_{post} = 1/\sigma_{R,eff}^2 + 1/\sigma_{R,fc}^2$$

Posterior mean:
$$\mu_{R,post} = \frac{\mu_R / \sigma_{R,eff}^2 + R_{fc} / \sigma_{R,fc}^2}{\tau_{post}}$$

### 5. Apply Soft Bounds
If constraint exists (e.g., all historical $R < 1$):
$$\mu_{R,post} = p_{constraint} \cdot \min(\mu_{R,post}, R_{max}) + (1 - p_{constraint}) \cdot \mu_{R,post}$$

### 6. Recover Corrected Forecast
$$Q_{curr}^{corrected} = Q_{prev} \times \mu_{R,post}$$

---

## Key Properties
- **Few years** → wide prior → forecast dominates → weak correction
- **Many years** → tight prior → climatology dominates → strong correction
- **Relative correction** → wet/dry year signal preserved