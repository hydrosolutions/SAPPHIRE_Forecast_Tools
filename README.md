![example workflow](https://github.com/hydrosolutions/SAPPHIRE_Forecast_Tools/actions/workflows/main.yml/badge.svg)

# SAPPHIRE_forecast_tools
Tools for operational hydrological forecasting for Central Asian hydromets. The tools are co-designed with the Kyrgyz Hydrometeorological Services as part of the ongoing [SAPPHIRE project](https://www.hydrosolutions.ch/projects/sapphire-central-asia) and funded by the [Swiss Agency for Development and Cooperation](https://www.eda.admin.ch/eda/en/home/fdfa/organisation-fdfa/directorates-divisions/sdc.html).

The tools are designed to be deployed on a local computer with access to operational hydrometerological data and the [iEasyHydro](https://ieasyhydro.org) database. This repository holds data from the public domain for demonstration.

Note that this repository is **WORK IN PROGRESS**.

# Overview
3 tools are currently deployed via Docker and provided in this repository (see folder apps):
  - A dashboard to configure the forecast tools
  - A tool to produce linear regression forecasts as currently employed by the Kyrgyz Hydrometeorological Services
  - A dashboard to visualize and download the forecasts

## Folder structure
All software components are in the apps directory. A .env file holds file & folder addresses and access information to the iEasyHydro Database. Files that need to be reviewed and potentially edited or replaced for local deployment are highlighted with a #. They are discussed in more detail in the file doc/deployment.md.
Potentially sensitive data that needs to be provided by a hydromet (for example daily discharge data used for the development of the forecast models) is stored in the data folder. Here we provide publicly available data examples from Switzerland for demonstration.
```
  SAPPHIRE_FORECAST_TOOLS
   |__ apps
        |__ config
            Configuration of the forecast tools. The content of the files needs to be adapted to deployment conditions.
#            |__ .env
                 Holds file and folder paths as well as access information to the iEasyHydro Database. This file is read by all forecast tools when deployed using Docker.
             |__ .env_develop
                 Same as .env but for local development. This file is read by all forecast tools when run locally as local folder structer differs from deployed folder structure.
#            |__ config_all_stations_library.json
                 Information about all stations that are potentially available for the forecasting tools. This includes station codes, names, and coordinates.
                 -> TODO: Need to describe how to write this list initially.
             |__ config_output.json
                 Defines what outputs are generated by the forecast tools. This file is written by the forecast configuration dashboard.
             |__ config_stations.json
                 A list of stations selected for the production of forecasts. This file is written by the forecast configuration dashboard.
        |__ configuration_dashboard
            A user interface to configure for which stations forecasts are produced and what outputs are generated. The dashboard is written in R and uses the Shiny framework.
             |__ www
                 Static files (icon Station.jpg) used by the dashboard.
             |__ dockerfile
                 Dockerfile to build the docker image for the forecast configuration dashboard.
             |__ forecast_configuration.R
                 The R script that runs the forecast configuration dashboard.

        |__ iEasyHydroForecast
            A collection of python functions that are used by the linear regression tool.
#  |__ data
       Example data to demonstrate how the forecast tools work. The Needs to be replaced with data by the hydromet organization for deployment. The data and file formats are described in more detail in the file doc/deployment.md.
        |__ daily_runoff
            Daily discharge data for the development of the forecast models. The data is stored in Excel files. The paths to these files are configured in the .env file.
        |__ GIS
            GIS data for the forecast configuration dashboard. The data is stored in shape files. The paths to these files are configured in the .env file.
   |__ doc
        |__ deployment.md
            Deployment instructions
```

The following figure shows how the software components interact with each other through configuration files and data files.

<img src="doc/www/io.png" alt="IO" width="600"/>

# Deployment
The SAPPHIRE Forecast Tools are deployed using the Docker system. The deployment of the forecast tools is described in detail in the file doc/deployment.md.

# Development
If you wish to run the forecast tools individually and locally for development purposes, you can do so by following the instructions in the file doc/development.md.

## Collaboration
Input from users is welcome. Please use the GitHub issue tracker to report bugs or suggest improvements. If you would like to contribute to the code, please fork the repository and submit a pull request. We will review the pull request and merge it if it fits the scope of the project. Please note that this is an open source project released under the MIT license, under which all contrubutions fall. Contributors are expected to adhere to the [Contributor Covenant code of conduct](https://www.contributor-covenant.org/).
